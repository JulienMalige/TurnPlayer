<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />

        <title>Hello World</title>
    </head>
    <body>
        <div class="app">
            <div id="deviceready" class="blink">

                <div id="vinyle"></div>

                <audio id="player" src="#" preload="auto"></audio>

                <div id="cover" class="cover"></div>
                <div id="artist" class="marquee artist">Artiste</div>
                <div id="title" class="marquee title">Titre</div>

                <!--<p id="swapinfo"> OFF </p>
                <p id="cptinfo">  </p>
                <p id="uri">  </p>-->
            </div>
        </div>
        <script type="text/javascript" src="cordova.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
        <script type="text/javascript" src="js/jquerymobile-swipeupdown.js"></script>

        <!--        <script type="text/javascript" src="js/index.js"></script>-->
        <script type="text/javascript">

            $(function(){
                $(document).on( "swipedown", swipeHandler );
                $(document).bind( "tap", tapHandler );

                function swipeHandler(){
                    $("#swapinfo").text("ON");
                    chrono();
                }

                function tapHandler(){
                    $("#swapinfo").text("OFF");
                    stopChrono();

                }

                var degree=0;

                $("#start").click(function(){
                    chrono();
                });
                $("#pause").click(function(){
                    stopChrono();
                });

                function chrono(){
                    compteur = setInterval(function(){
                        if(degree>=360){degree=0;}
                        degree++;
                        $('#vinyle').css('-webkit-transform', 'rotate('+degree*4+'deg)');
                        $('#cptinfo').text(degree*4);

                    },10)
                }

                function stopChrono(){
                    clearInterval(compteur);
                }

            });

        </script>

        <script src="js/player/audio.min.js"></script>

        <script src="//cdn.jsdelivr.net/jquery.marquee/1.3.1/jquery.marquee.min.js" type="text/javascript"></script>

        <script type="text/javascript">
            $(function connect() {
                randomId = Math.random();
                randomId = randomId*1000000000;
                randomId = Math.round(randomId);
                console.log(randomId);

                $.get("http://api.soundcloud.com/tracks/"+randomId+".json?client_id=69f9f6cb4aae2f1b2fca3f809ff86ffe")
                    .done(function (data) {

                            $('#player').attr("src", "http://api.soundcloud.com/tracks/" + data.id + "/stream?client_id=69f9f6cb4aae2f1b2fca3f809ff86ffe");
                            $('#uri').text("http://api.soundcloud.com/tracks/" + data.id + "/stream?client_id=69f9f6cb4aae2f1b2fca3f809ff86ffe");
                            $('#title').text(data.title);
                            $('#artist').text(data.user.username);

                            if (data.artwork_url != null) {
                                artwork_url = data.artwork_url;
                                res = artwork_url.substr(0, (artwork_url.length - 9));
                                $('#cover').css("background-image", "url(" + res + "t300x300.jpg)");
                            } else {
                                $('#cover').css("background-image", "url('')");
                            }


                            audiojs.createAll();

                            //$('.marquee').marquee();



                        }).fail(function() {
                            connect();
                        });


            });
        </script>





    </body>
</html>
